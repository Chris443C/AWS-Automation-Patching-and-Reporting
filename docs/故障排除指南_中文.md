# ğŸ”§ æ•…éšœæ’é™¤æŒ‡å—ï¼ˆä¸­æ–‡ç‰ˆï¼‰

æœ¬æŒ‡å—å¸®åŠ©æ‚¨è§£å†³ AWS è‡ªåŠ¨åŒ–è¡¥ä¸ç®¡ç†ç³»ç»Ÿä¸­çš„å¸¸è§é—®é¢˜ã€‚

## ğŸš¨ ç´§æ€¥é—®é¢˜

### é—®é¢˜ï¼šç³»ç»Ÿå®Œå…¨æ— æ³•å·¥ä½œ
**ç—‡çŠ¶ï¼š** æ²¡æœ‰ä»»ä½•é€šçŸ¥ï¼Œæ— æ³•è®¿é—® AWS æœåŠ¡

**å¿«é€Ÿè§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. ç¡®è®¤ AWS è´¦æˆ·çŠ¶æ€
3. éªŒè¯ AWS å‡­æ®æ˜¯å¦è¿‡æœŸ

**è¯¦ç»†æ­¥éª¤ï¼š**
```bash
# æ£€æŸ¥ AWS å‡­æ®
aws sts get-caller-identity

# æ£€æŸ¥ç½‘ç»œè¿æ¥
ping aws.amazon.com
```

---

## ğŸ“‹ å¸¸è§é—®é¢˜åˆ†ç±»

### ğŸ”‘ è®¤è¯å’Œæƒé™é—®é¢˜

#### é—®é¢˜ 1ï¼šAWS CLI æœªæ‰¾åˆ°
**é”™è¯¯ä¿¡æ¯ï¼š** `'aws' is not recognized as an internal or external command`

**è§£å†³æ–¹æ¡ˆï¼š**
1. **é‡æ–°å®‰è£… AWS CLI**
   - Windows: ä¸‹è½½å¹¶è¿è¡Œ https://awscli.amazonaws.com/AWSCLIV2.msi
   - macOS: `curl "https://awscli.amazonaws.com/AWSCLIV2.pkg" -o "AWSCLIV2.pkg" && sudo installer -pkg AWSCLIV2.pkg -target /`
   - Linux: `curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip" && unzip awscliv2.zip && sudo ./aws/install`

2. **é‡å¯å‘½ä»¤è¡Œå·¥å…·**
3. **æ£€æŸ¥ PATH ç¯å¢ƒå˜é‡**

#### é—®é¢˜ 2ï¼šAWS å‡­æ®æ— æ•ˆ
**é”™è¯¯ä¿¡æ¯ï¼š** `Unable to locate credentials` æˆ– `Invalid credentials`

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# é‡æ–°é…ç½®å‡­æ®
aws configure

# è¾“å…¥æ­£ç¡®çš„ä¿¡æ¯ï¼š
# AWS Access Key ID: [æ‚¨çš„è®¿é—®å¯†é’¥]
# AWS Secret Access Key: [æ‚¨çš„ç§˜å¯†å¯†é’¥]
# Default region: us-east-1
# Default output format: json
```

**å¦‚ä½•è·å–æ–°çš„è®¿é—®å¯†é’¥ï¼š**
1. ç™»å½• AWS æ§åˆ¶å°
2. ç‚¹å‡»å³ä¸Šè§’ç”¨æˆ·å
3. é€‰æ‹© "Security credentials"
4. åœ¨ "Access keys" éƒ¨åˆ†åˆ›å»ºæ–°çš„è®¿é—®å¯†é’¥

#### é—®é¢˜ 3ï¼šæƒé™ä¸è¶³
**é”™è¯¯ä¿¡æ¯ï¼š** `Access Denied` æˆ– `Insufficient permissions`

**è§£å†³æ–¹æ¡ˆï¼š**
1. ç¡®è®¤ç”¨æˆ·æœ‰ç®¡ç†å‘˜æƒé™
2. æ£€æŸ¥ IAM ç­–ç•¥æ˜¯å¦åŒ…å«å¿…è¦æƒé™
3. è”ç³» AWS ç®¡ç†å‘˜è·å–é€‚å½“æƒé™

---

### ğŸ–¥ï¸ æœåŠ¡å™¨è¿æ¥é—®é¢˜

#### é—®é¢˜ 4ï¼šæœåŠ¡å™¨æ— å“åº”
**é”™è¯¯ä¿¡æ¯ï¼š** `Instance is not responding` æˆ– `Connection timeout`

**è§£å†³æ–¹æ¡ˆï¼š**

**æ£€æŸ¥ Systems Manager ä»£ç†ï¼š**
```powershell
# Windows æœåŠ¡å™¨
Get-Service -Name AmazonSSMAgent

# Linux æœåŠ¡å™¨
sudo systemctl status amazon-ssm-agent
```

**å¦‚æœä»£ç†æœªè¿è¡Œï¼Œè¯·å®‰è£…ï¼š**

**Amazon Linux 2ï¼š**
```bash
sudo yum install -y amazon-ssm-agent
sudo systemctl enable amazon-ssm-agent
sudo systemctl start amazon-ssm-agent
```

**Ubuntuï¼š**
```bash
sudo snap install amazon-ssm-agent --classic
sudo systemctl enable snap.amazon-ssm-agent.amazon-ssm-agent.service
sudo systemctl start snap.amazon-ssm-agent.amazon-ssm-agent.service
```

**Windowsï¼š**
1. ä¸‹è½½ä»£ç†ï¼šhttps://s3.amazonaws.com/amazon-ssm-region/latest/windows_amd64/AmazonSSMAgentSetup.exe
2. è¿è¡Œå®‰è£…ç¨‹åº
3. é‡å¯æœåŠ¡ï¼š`Restart-Service AmazonSSMAgent`

#### é—®é¢˜ 5ï¼šIAM è§’è‰²æƒé™ä¸è¶³
**é”™è¯¯ä¿¡æ¯ï¼š** `The instance profile associated with the instance does not have the required permissions`

**è§£å†³æ–¹æ¡ˆï¼š**
1. ä¸ºæœåŠ¡å™¨å®ä¾‹æ·»åŠ  IAM è§’è‰²
2. ç¡®ä¿è§’è‰²åŒ…å«ä»¥ä¸‹ç­–ç•¥ï¼š
   - `AmazonSSMManagedInstanceCore`
   - `CloudWatchAgentServerPolicy`ï¼ˆå¯é€‰ï¼‰

**æ·»åŠ  IAM è§’è‰²ï¼š**
1. ç™»å½• AWS æ§åˆ¶å°
2. è¿›å…¥ EC2 æœåŠ¡
3. é€‰æ‹©ç›®æ ‡å®ä¾‹
4. ç‚¹å‡» "Actions" â†’ "Security" â†’ "Modify IAM role"
5. é€‰æ‹©é€‚å½“çš„è§’è‰²

---

### ğŸ”§ è¡¥ä¸ç®¡ç†é—®é¢˜

#### é—®é¢˜ 6ï¼šè¡¥ä¸åŸºçº¿æœªæ‰¾åˆ°
**é”™è¯¯ä¿¡æ¯ï¼š** `Patch baseline not found` æˆ– `No patch baseline associated`

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# åˆ—å‡ºå¯ç”¨çš„è¡¥ä¸åŸºçº¿
aws ssm describe-patch-baselines

# éªŒè¯åŸºçº¿å…³è”
aws ssm describe-patch-groups
```

**æ‰‹åŠ¨åˆ›å»ºè¡¥ä¸åŸºçº¿ï¼š**
1. ç™»å½• AWS æ§åˆ¶å°
2. è¿›å…¥ Systems Manager æœåŠ¡
3. ç‚¹å‡» "Patch Manager"
4. ç‚¹å‡» "Create patch baseline"
5. é…ç½®åŸºçº¿è®¾ç½®

#### é—®é¢˜ 7ï¼šè¡¥ä¸æ‰«æå¤±è´¥
**é”™è¯¯ä¿¡æ¯ï¼š** `Patch scan failed` æˆ– `No patches available`

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥æœåŠ¡å™¨æ ‡ç­¾æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤æ“ä½œç³»ç»Ÿç±»å‹åŒ¹é…
3. éªŒè¯ç½‘ç»œè¿æ¥

**æ£€æŸ¥æœåŠ¡å™¨æ ‡ç­¾ï¼š**
```bash
# æŸ¥çœ‹å®ä¾‹æ ‡ç­¾
aws ec2 describe-instances --instance-ids i-1234567890abcdef0 --query 'Reservations[].Instances[].Tags'

# æ·»åŠ æ­£ç¡®çš„æ ‡ç­¾
aws ec2 create-tags --resources i-1234567890abcdef0 --tags Key=PatchGroup,Value=dev-servers
```

#### é—®é¢˜ 8ï¼šè¡¥ä¸å®‰è£…å¤±è´¥
**é”™è¯¯ä¿¡æ¯ï¼š** `Patch installation failed` æˆ– `Reboot required`

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´
2. ç¡®è®¤æœåŠ¡å™¨å¯ä»¥é‡å¯
3. æŸ¥çœ‹è¯¦ç»†çš„é”™è¯¯æ—¥å¿—

**æ£€æŸ¥ç£ç›˜ç©ºé—´ï¼š**
```bash
# Linux
df -h

# Windows PowerShell
Get-WmiObject -Class Win32_LogicalDisk | Select-Object DeviceID, Size, FreeSpace
```

---

### ğŸ“§ é€šçŸ¥é—®é¢˜

#### é—®é¢˜ 9ï¼šæ²¡æœ‰æ”¶åˆ°é‚®ä»¶é€šçŸ¥
**ç—‡çŠ¶ï¼š** ç³»ç»Ÿè¿è¡Œæ­£å¸¸ï¼Œä½†æ²¡æœ‰æ”¶åˆ°ä»»ä½•é‚®ä»¶

**è§£å†³æ–¹æ¡ˆï¼š**

**æ£€æŸ¥ SNS è®¢é˜…çŠ¶æ€ï¼š**
1. ç™»å½• AWS æ§åˆ¶å°
2. è¿›å…¥ SNS æœåŠ¡
3. æ‰¾åˆ°ä¸»é¢˜ï¼š`PatchingApprovalNotifications-dev`
4. æ£€æŸ¥è®¢é˜…çŠ¶æ€æ˜¯å¦ä¸º "Confirmed"

**é‡æ–°è®¢é˜…ï¼š**
1. åˆ é™¤ç°æœ‰è®¢é˜…
2. åˆ›å»ºæ–°è®¢é˜…
3. æ£€æŸ¥é‚®ç®±å¹¶ç¡®è®¤è®¢é˜…

**æ£€æŸ¥åƒåœ¾é‚®ä»¶æ–‡ä»¶å¤¹ï¼š**
- æŸ¥çœ‹é‚®ç®±çš„åƒåœ¾é‚®ä»¶æ–‡ä»¶å¤¹
- å°† AWS é‚®ä»¶åœ°å€æ·»åŠ åˆ°ç™½åå•

#### é—®é¢˜ 10ï¼šé‚®ä»¶å†…å®¹ä¸å®Œæ•´
**ç—‡çŠ¶ï¼š** æ”¶åˆ°é‚®ä»¶ä½†ä¿¡æ¯ä¸å®Œæ•´

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥é‚®ä»¶å®¢æˆ·ç«¯è®¾ç½®
2. å°è¯•ä½¿ç”¨ä¸åŒçš„é‚®ä»¶å®¢æˆ·ç«¯
3. æŸ¥çœ‹ S3 ä¸­çš„å®Œæ•´æŠ¥å‘Š

---

### ğŸ“Š æŠ¥å‘Šå’Œç›‘æ§é—®é¢˜

#### é—®é¢˜ 11ï¼šæ— æ³•æŸ¥çœ‹ CloudWatch ä»ªè¡¨æ¿
**é”™è¯¯ä¿¡æ¯ï¼š** `Dashboard not found` æˆ– `Access denied`

**è§£å†³æ–¹æ¡ˆï¼š**
1. ç¡®è®¤ CloudWatch æƒé™
2. æ£€æŸ¥ä»ªè¡¨æ¿åç§°æ˜¯å¦æ­£ç¡®
3. éªŒè¯åŒºåŸŸè®¾ç½®

**æŸ¥çœ‹ä»ªè¡¨æ¿ï¼š**
1. ç™»å½• AWS æ§åˆ¶å°
2. è¿›å…¥ CloudWatch æœåŠ¡
3. ç‚¹å‡» "Dashboards"
4. æŸ¥æ‰¾ "PatchingAutomation-dev"

#### é—®é¢˜ 12ï¼šS3 æŠ¥å‘Šæ— æ³•è®¿é—®
**é”™è¯¯ä¿¡æ¯ï¼š** `Access denied` æˆ– `Bucket not found`

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥ S3 å­˜å‚¨æ¡¶æƒé™
2. ç¡®è®¤å­˜å‚¨æ¡¶åç§°æ­£ç¡®
3. éªŒè¯åŒºåŸŸè®¾ç½®

**æŸ¥çœ‹æŠ¥å‘Šï¼š**
1. ç™»å½• AWS æ§åˆ¶å°
2. è¿›å…¥ S3 æœåŠ¡
3. æ‰¾åˆ°æ‚¨çš„æŠ¥å‘Šå­˜å‚¨æ¡¶
4. æµè§ˆæ–‡ä»¶å¤¹æŸ¥çœ‹æŠ¥å‘Š

---

### ğŸ” Lambda å‡½æ•°é—®é¢˜

#### é—®é¢˜ 13ï¼šLambda å‡½æ•°é”™è¯¯
**é”™è¯¯ä¿¡æ¯ï¼š** `Lambda function error` æˆ– `Function timeout`

**è§£å†³æ–¹æ¡ˆï¼š**

**æŸ¥çœ‹ Lambda æ—¥å¿—ï¼š**
```bash
# åˆ—å‡ºæ—¥å¿—ç»„
aws logs describe-log-groups --log-group-name-prefix "/aws/lambda/PatchingAutomation"

# æŸ¥çœ‹æœ€è¿‘çš„æ—¥å¿—
aws logs filter-log-events --log-group-name "/aws/lambda/PatchingAutomationLambdaRole-dev" --start-time $(date -d '1 hour ago' +%s)000
```

**æ£€æŸ¥ Lambda å‡½æ•°çŠ¶æ€ï¼š**
1. ç™»å½• AWS æ§åˆ¶å°
2. è¿›å…¥ Lambda æœåŠ¡
3. æŸ¥æ‰¾ç›¸å…³å‡½æ•°
4. æ£€æŸ¥å‡½æ•°é…ç½®å’Œæƒé™

---

## ğŸ› ï¸ è¯Šæ–­å·¥å…·

### ç³»ç»Ÿå¥åº·æ£€æŸ¥è„šæœ¬
```bash
#!/bin/bash
echo "=== AWS è‡ªåŠ¨åŒ–è¡¥ä¸ç®¡ç†ç³»ç»Ÿå¥åº·æ£€æŸ¥ ==="

# æ£€æŸ¥ AWS CLI
echo "1. æ£€æŸ¥ AWS CLI..."
if command -v aws &> /dev/null; then
    echo "âœ“ AWS CLI å·²å®‰è£…"
    aws --version
else
    echo "âœ— AWS CLI æœªå®‰è£…"
fi

# æ£€æŸ¥ AWS å‡­æ®
echo "2. æ£€æŸ¥ AWS å‡­æ®..."
aws sts get-caller-identity

# æ£€æŸ¥ Systems Manager ä»£ç†
echo "3. æ£€æŸ¥ Systems Manager ä»£ç†..."
if systemctl is-active --quiet amazon-ssm-agent; then
    echo "âœ“ SSM ä»£ç†æ­£åœ¨è¿è¡Œ"
else
    echo "âœ— SSM ä»£ç†æœªè¿è¡Œ"
fi

# æ£€æŸ¥è¡¥ä¸åŸºçº¿
echo "4. æ£€æŸ¥è¡¥ä¸åŸºçº¿..."
aws ssm describe-patch-baselines

echo "=== å¥åº·æ£€æŸ¥å®Œæˆ ==="
```

### å¿«é€Ÿä¿®å¤å‘½ä»¤
```bash
# é‡å¯ Systems Manager ä»£ç†
sudo systemctl restart amazon-ssm-agent

# é‡æ–°é…ç½® AWS å‡­æ®
aws configure

# æµ‹è¯•è¡¥ä¸æ‰«æ
aws ssm send-command --instance-ids i-1234567890abcdef0 --document-name "AWS-RunPatchBaseline" --parameters '{"Operation":["Scan"]}'

# æŸ¥çœ‹æœ€è¿‘çš„æ—¥å¿—
aws logs filter-log-events --log-group-name "/aws/lambda/PatchingAutomationLambdaRole-dev" --start-time $(date -d '1 hour ago' +%s)000
```

---

## ğŸ“ è·å–å¸®åŠ©

### è‡ªåŠ©è§£å†³
1. **æŸ¥çœ‹æ—¥å¿—**ï¼šCloudWatch â†’ Log groups
2. **æ£€æŸ¥çŠ¶æ€**ï¼šSystems Manager â†’ Compliance
3. **æŸ¥çœ‹æŠ¥å‘Š**ï¼šS3 â†’ æ‚¨çš„å­˜å‚¨æ¡¶

### è”ç³»æ”¯æŒ
1. **åˆ›å»º GitHub Issue**ï¼šæè¿°é—®é¢˜å’Œé”™è¯¯ä¿¡æ¯
2. **è”ç³» AWS æ”¯æŒ**ï¼šå¦‚æœæ˜¯ AWS æœåŠ¡é—®é¢˜
3. **æŸ¥çœ‹ AWS æ–‡æ¡£**ï¼šSystems Managerã€Inspector ç­‰

### æœ‰ç”¨çš„é“¾æ¥
- [AWS Systems Manager æ–‡æ¡£](https://docs.aws.amazon.com/systems-manager/)
- [AWS Inspector æ–‡æ¡£](https://docs.aws.amazon.com/inspector/)
- [AWS CLI æ–‡æ¡£](https://docs.aws.amazon.com/cli/)

---

## ğŸ¯ é¢„é˜²æªæ–½

### å®šæœŸç»´æŠ¤
1. **æ¯å‘¨æ£€æŸ¥**ï¼šè¡¥ä¸åˆè§„çŠ¶æ€
2. **æ¯æœˆå®¡æŸ¥**ï¼šå®‰å…¨é…ç½®
3. **æ¯å­£åº¦æ›´æ–°**ï¼šè¡¥ä¸åŸºçº¿

### ç›‘æ§å»ºè®®
1. **è®¾ç½® CloudWatch å‘Šè­¦**
2. **å®šæœŸæŸ¥çœ‹ S3 æŠ¥å‘Š**
3. **ç›‘æ§ AWS æˆæœ¬**

### å¤‡ä»½ç­–ç•¥
1. **å®šæœŸå¤‡ä»½é…ç½®æ–‡ä»¶**
2. **å¯¼å‡ºé‡è¦è®¾ç½®**
3. **è®°å½•å˜æ›´å†å²**

---

## âœ… é—®é¢˜è§£å†³æ£€æŸ¥æ¸…å•

åœ¨è”ç³»æ”¯æŒä¹‹å‰ï¼Œè¯·ç¡®è®¤ï¼š

- [ ] å·²æ£€æŸ¥ AWS CLI æ˜¯å¦å®‰è£…
- [ ] å·²éªŒè¯ AWS å‡­æ®æ˜¯å¦æœ‰æ•ˆ
- [ ] å·²ç¡®è®¤æœåŠ¡å™¨æ ‡ç­¾æ˜¯å¦æ­£ç¡®
- [ ] å·²æ£€æŸ¥ Systems Manager ä»£ç†çŠ¶æ€
- [ ] å·²æŸ¥çœ‹ CloudWatch æ—¥å¿—
- [ ] å·²å°è¯•é‡å¯ç›¸å…³æœåŠ¡
- [ ] å·²æ£€æŸ¥ç½‘ç»œè¿æ¥
- [ ] å·²ç¡®è®¤æƒé™è®¾ç½®

å¦‚æœä»¥ä¸Šæ­¥éª¤éƒ½æ— æ³•è§£å†³é—®é¢˜ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š
1. é”™è¯¯ä¿¡æ¯çš„å®Œæ•´æ–‡æœ¬
2. ç³»ç»Ÿé…ç½®ä¿¡æ¯
3. æ“ä½œæ­¥éª¤çš„è¯¦ç»†æè¿°
4. ç›¸å…³çš„æ—¥å¿—æ–‡ä»¶ 