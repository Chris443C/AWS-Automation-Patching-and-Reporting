# AWS è‡ªåŠ¨åŒ–è¡¥ä¸ç®¡ç†éƒ¨ç½²æŒ‡å—ï¼ˆä¸­æ–‡ç‰ˆï¼‰

æœ¬æŒ‡å—ä¸ºä¸ç†Ÿæ‚‰ AWS çš„ç”¨æˆ·æä¾›ç®€å•æ˜“æ‡‚çš„éƒ¨ç½²æ­¥éª¤ã€‚

## ğŸ“‹ éƒ¨ç½²å‰å‡†å¤‡æ¸…å•

### âœ… å¿…éœ€é¡¹ç›®
- [ ] AWS è´¦æˆ·ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰
- [ ] ç”µè„‘å·²å®‰è£… AWS CLI
- [ ] ç”µè„‘å·²å®‰è£… Python 3.8+
- [ ] ç”µè„‘å·²å®‰è£… PowerShell 5.1+
- [ ] ç›®æ ‡æœåŠ¡å™¨å·²å®‰è£… AWS Systems Manager ä»£ç†

### ğŸ“ éœ€è¦å‡†å¤‡çš„ä¿¡æ¯
- [ ] AWS è®¿é—®å¯†é’¥ ID
- [ ] AWS ç§˜å¯†è®¿é—®å¯†é’¥
- [ ] é€šçŸ¥é‚®ç®±åœ°å€
- [ ] ç›®æ ‡æœåŠ¡å™¨å®ä¾‹ ID

## ğŸš€ ç¬¬ä¸€æ­¥ï¼šç¯å¢ƒå‡†å¤‡

### 1.1 ä¸‹è½½é¡¹ç›®æ–‡ä»¶

**æ–¹æ³•ä¸€ï¼šä½¿ç”¨ Gitï¼ˆæ¨èï¼‰**
```bash
git clone https://github.com/your-org/aws-automation-patching-and-reporting.git
cd aws-automation-patching-and-reporting
```

**æ–¹æ³•äºŒï¼šç›´æ¥ä¸‹è½½**
1. è®¿é—®é¡¹ç›® GitHub é¡µé¢
2. ç‚¹å‡» "Code" æŒ‰é’®
3. é€‰æ‹© "Download ZIP"
4. è§£å‹åˆ°æœ¬åœ°æ–‡ä»¶å¤¹

### 1.2 å®‰è£… AWS CLI

**Windows ç”¨æˆ·ï¼š**
1. ä¸‹è½½ AWS CLI å®‰è£…ç¨‹åºï¼šhttps://awscli.amazonaws.com/AWSCLIV2.msi
2. åŒå‡»è¿è¡Œå®‰è£…ç¨‹åº
3. æŒ‰ç…§æç¤ºå®Œæˆå®‰è£…

**macOS ç”¨æˆ·ï¼š**
```bash
curl "https://awscli.amazonaws.com/AWSCLIV2.pkg" -o "AWSCLIV2.pkg"
sudo installer -pkg AWSCLIV2.pkg -target /
```

**Linux ç”¨æˆ·ï¼š**
```bash
curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
unzip awscliv2.zip
sudo ./aws/install
```

### 1.3 é…ç½® AWS å‡­æ®

æ‰“å¼€å‘½ä»¤è¡Œå·¥å…·ï¼ˆPowerShell æˆ–ç»ˆç«¯ï¼‰ï¼Œè¿è¡Œï¼š

```bash
aws configure
```

ç³»ç»Ÿä¼šæç¤ºæ‚¨è¾“å…¥ä»¥ä¸‹ä¿¡æ¯ï¼š

```
AWS Access Key ID [None]: AKIAIOSFODNN7EXAMPLE
AWS Secret Access Key [None]: wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
Default region name [None]: us-east-1
Default output format [None]: json
```

**å¦‚ä½•è·å– AWS å‡­æ®ï¼š**
1. ç™»å½• AWS æ§åˆ¶å°
2. ç‚¹å‡»å³ä¸Šè§’ç”¨æˆ·å
3. é€‰æ‹© "Security credentials"
4. åœ¨ "Access keys" éƒ¨åˆ†åˆ›å»ºæ–°çš„è®¿é—®å¯†é’¥

## ğŸ› ï¸ ç¬¬äºŒæ­¥ï¼šä¸€é”®éƒ¨ç½²

### 2.1 ä½¿ç”¨è‡ªåŠ¨éƒ¨ç½²è„šæœ¬

åœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸­æ‰“å¼€ PowerShellï¼Œè¿è¡Œï¼š

```powershell
# å¼€å‘ç¯å¢ƒéƒ¨ç½²
.\deploy.ps1 -Environment dev -NotificationEmail your-email@company.com

# ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
.\deploy.ps1 -Environment prod -NotificationEmail admin@company.com -S3BucketName "my-company-patching-reports"
```

### 2.2 éƒ¨ç½²è¿‡ç¨‹è¯´æ˜

éƒ¨ç½²è„šæœ¬ä¼šè‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š

1. **æ£€æŸ¥ç¯å¢ƒ** âœ…
   - éªŒè¯ AWS CLI æ˜¯å¦å®‰è£…
   - æ£€æŸ¥ AWS å‡­æ®æ˜¯å¦æœ‰æ•ˆ
   - éªŒè¯é…ç½®æ–‡ä»¶æ˜¯å¦å­˜åœ¨

2. **éƒ¨ç½²åŸºç¡€è®¾æ–½** ğŸ—ï¸
   - åˆ›å»º S3 å­˜å‚¨æ¡¶ï¼ˆå­˜å‚¨æŠ¥å‘Šï¼‰
   - åˆ›å»º Lambda å‡½æ•°ï¼ˆè‡ªåŠ¨åŒ–å¤„ç†ï¼‰
   - åˆ›å»º SNS ä¸»é¢˜ï¼ˆå‘é€é€šçŸ¥ï¼‰
   - åˆ›å»º EventBridge è§„åˆ™ï¼ˆå®šæ—¶ä»»åŠ¡ï¼‰

3. **é…ç½® AWS Inspector** ğŸ”
   - å¯ç”¨æ¼æ´æ‰«æ
   - è®¾ç½®æ‰«æè§„åˆ™
   - é…ç½®é€šçŸ¥

4. **è®¾ç½®è¡¥ä¸ç®¡ç†å™¨** ğŸ”§
   - åˆ›å»ºè¡¥ä¸åŸºçº¿
   - è®¾ç½®ç»´æŠ¤çª—å£
   - é…ç½®å®¡æ‰¹å·¥ä½œæµ

### 2.3 éƒ¨ç½²æˆåŠŸæ ‡å¿—

éƒ¨ç½²å®Œæˆåï¼Œæ‚¨ä¼šçœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹ä¿¡æ¯ï¼š

```
=== DEPLOYMENT COMPLETED ===
Next steps:
1. Configure target instances with Systems Manager agent
2. Tag instances with PatchGroup=dev-servers
3. Subscribe to SNS notifications
4. Test the automation with a manual patch scan
5. Review the deployment guide for detailed instructions
=============================
```

## ğŸ–¥ï¸ ç¬¬ä¸‰æ­¥ï¼šé…ç½®ç›®æ ‡æœåŠ¡å™¨

### 3.1 ä¸ºæœåŠ¡å™¨æ·»åŠ æ ‡ç­¾

**æ–¹æ³•ä¸€ï¼šä½¿ç”¨ AWS CLI**
```bash
aws ec2 create-tags --resources i-1234567890abcdef0 --tags Key=PatchGroup,Value=dev-servers
```

**æ–¹æ³•äºŒï¼šä½¿ç”¨ AWS æ§åˆ¶å°**
1. ç™»å½• AWS æ§åˆ¶å°
2. è¿›å…¥ EC2 æœåŠ¡
3. é€‰æ‹©ç›®æ ‡å®ä¾‹
4. ç‚¹å‡» "Actions" â†’ "Manage tags"
5. æ·»åŠ æ ‡ç­¾ï¼šKey=PatchGroup, Value=dev-servers

### 3.2 æ£€æŸ¥ Systems Manager ä»£ç†

**Windows æœåŠ¡å™¨ï¼š**
```powershell
Get-Service -Name AmazonSSMAgent
```

**Linux æœåŠ¡å™¨ï¼š**
```bash
sudo systemctl status amazon-ssm-agent
```

**å¦‚æœä»£ç†æœªè¿è¡Œï¼Œè¯·å®‰è£…ï¼š**

**Amazon Linux 2ï¼š**
```bash
sudo yum install -y amazon-ssm-agent
sudo systemctl enable amazon-ssm-agent
sudo systemctl start amazon-ssm-agent
```

**Ubuntuï¼š**
```bash
sudo snap install amazon-ssm-agent --classic
sudo systemctl enable snap.amazon-ssm-agent.amazon-ssm-agent.service
sudo systemctl start snap.amazon-ssm-agent.amazon-ssm-agent.service
```

## ğŸ“§ ç¬¬å››æ­¥ï¼šé…ç½®é€šçŸ¥

### 4.1 è®¢é˜… SNS é€šçŸ¥

1. ç™»å½• AWS æ§åˆ¶å°
2. è¿›å…¥ SNS æœåŠ¡
3. æ‰¾åˆ°åä¸º "PatchingApprovalNotifications-dev" çš„ä¸»é¢˜
4. ç‚¹å‡»ä¸»é¢˜åç§°
5. ç‚¹å‡» "Create subscription"
6. é€‰æ‹©åè®®ï¼šEmail
7. è¾“å…¥æ‚¨çš„é‚®ç®±åœ°å€
8. ç‚¹å‡» "Create subscription"
9. æ£€æŸ¥é‚®ç®±å¹¶ç¡®è®¤è®¢é˜…

### 4.2 æµ‹è¯•é€šçŸ¥

è¿è¡Œæµ‹è¯•å‘½ä»¤ï¼š
```bash
aws ssm send-command --instance-ids i-1234567890abcdef0 --document-name "AWS-RunPatchBaseline" --parameters '{"Operation":["Scan"]}'
```

## ğŸ§ª ç¬¬äº”æ­¥ï¼šæµ‹è¯•ç³»ç»Ÿ

### 5.1 æµ‹è¯•æ¼æ´æ‰«æ

```bash
# æ‰‹åŠ¨è§¦å‘ Inspector æ‰«æ
aws inspector2 start-scan --scan-type EC2 --resource-filter criteria='{"instanceTags":[{"key":"Environment","value":"dev"}]}'
```

### 5.2 æµ‹è¯•è¡¥ä¸æ‰«æ

```bash
# åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šè¿è¡Œè¡¥ä¸æ‰«æ
aws ssm send-command --instance-ids i-1234567890abcdef0 --document-name "AWS-RunPatchBaseline" --parameters '{"Operation":["Scan"]}'
```

### 5.3 æµ‹è¯•å®¡è®¡è„šæœ¬

```bash
# è¿è¡Œç³»ç»Ÿå®¡è®¡è„šæœ¬
aws ssm send-command --instance-ids i-1234567890abcdef0 --document-name "SystemAuditScript" --parameters '{"OutputPath":["C:\\temp\\test-audit.json"]}'
```

## ğŸ“Š ç¬¬å…­æ­¥ï¼šæŸ¥çœ‹ç»“æœ

### 6.1 æŸ¥çœ‹ CloudWatch ä»ªè¡¨æ¿

1. ç™»å½• AWS æ§åˆ¶å°
2. è¿›å…¥ CloudWatch æœåŠ¡
3. ç‚¹å‡» "Dashboards"
4. æ‰¾åˆ° "PatchingAutomation-dev" ä»ªè¡¨æ¿
5. æŸ¥çœ‹å„ç§æŒ‡æ ‡å’Œæ—¥å¿—

### 6.2 æŸ¥çœ‹ S3 æŠ¥å‘Š

1. ç™»å½• AWS æ§åˆ¶å°
2. è¿›å…¥ S3 æœåŠ¡
3. æ‰¾åˆ°æ‚¨çš„æŠ¥å‘Šå­˜å‚¨æ¡¶
4. æµè§ˆä»¥ä¸‹æ–‡ä»¶å¤¹ï¼š
   - `inspector-findings/` - æ¼æ´æ‰«æç»“æœ
   - `patch-compliance/` - è¡¥ä¸åˆè§„æŠ¥å‘Š
   - `patch-approvals/` - è¡¥ä¸å®¡æ‰¹è®°å½•

### 6.3 æŸ¥çœ‹ Systems Manager åˆè§„æ€§

1. ç™»å½• AWS æ§åˆ¶å°
2. è¿›å…¥ Systems Manager æœåŠ¡
3. ç‚¹å‡» "Compliance"
4. æŸ¥çœ‹è¡¥ä¸åˆè§„æ€§çŠ¶æ€

## ğŸ”§ å¸¸è§é—®é¢˜è§£å†³

### é—®é¢˜ 1ï¼šéƒ¨ç½²è„šæœ¬å¤±è´¥

**é”™è¯¯ä¿¡æ¯ï¼š** "AWS CLI not found"
**è§£å†³æ–¹æ¡ˆï¼š**
1. é‡æ–°å®‰è£… AWS CLI
2. é‡å¯å‘½ä»¤è¡Œå·¥å…·
3. æ£€æŸ¥ PATH ç¯å¢ƒå˜é‡

**é”™è¯¯ä¿¡æ¯ï¼š** "AWS credentials not configured"
**è§£å†³æ–¹æ¡ˆï¼š**
1. è¿è¡Œ `aws configure` é‡æ–°é…ç½®
2. æ£€æŸ¥è®¿é—®å¯†é’¥æ˜¯å¦æ­£ç¡®
3. ç¡®è®¤å¯†é’¥æœ‰è¶³å¤Ÿæƒé™

### é—®é¢˜ 2ï¼šæœåŠ¡å™¨æ— å“åº”

**é”™è¯¯ä¿¡æ¯ï¼š** "Instance is not responding"
**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥ Systems Manager ä»£ç†æ˜¯å¦è¿è¡Œ
2. ç¡®è®¤æœåŠ¡å™¨ IAM è§’è‰²åŒ…å«å¿…è¦æƒé™
3. æ£€æŸ¥ç½‘ç»œè¿æ¥

### é—®é¢˜ 3ï¼šè¡¥ä¸æ‰«æå¤±è´¥

**é”™è¯¯ä¿¡æ¯ï¼š** "Patch baseline not found"
**è§£å†³æ–¹æ¡ˆï¼š**
1. ç¡®è®¤è¡¥ä¸åŸºçº¿å·²åˆ›å»º
2. æ£€æŸ¥æœåŠ¡å™¨æ ‡ç­¾æ˜¯å¦æ­£ç¡®
3. éªŒè¯æ“ä½œç³»ç»Ÿç±»å‹åŒ¹é…

## ğŸ“ˆ ç›‘æ§å’Œç»´æŠ¤

### æ—¥å¸¸ç›‘æ§ä»»åŠ¡

1. **æ¯æ—¥æ£€æŸ¥**
   - æŸ¥çœ‹ SNS é€šçŸ¥é‚®ä»¶
   - æ£€æŸ¥ CloudWatch ä»ªè¡¨æ¿
   - æŸ¥çœ‹è¡¥ä¸åˆè§„çŠ¶æ€

2. **æ¯å‘¨æ£€æŸ¥**
   - å®¡æŸ¥è¡¥ä¸å®¡æ‰¹å†å²
   - æŸ¥çœ‹æ¼æ´æ‰«ææŠ¥å‘Š
   - æ£€æŸ¥ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡

3. **æ¯æœˆæ£€æŸ¥**
   - å®¡æŸ¥å®‰å…¨é…ç½®
   - æ›´æ–°è¡¥ä¸åŸºçº¿
   - ä¼˜åŒ–è‡ªåŠ¨åŒ–è§„åˆ™

### æˆæœ¬ä¼˜åŒ–å»ºè®®

1. **S3 å­˜å‚¨ä¼˜åŒ–**
   - è®¾ç½®ç”Ÿå‘½å‘¨æœŸç­–ç•¥åˆ é™¤æ—§æŠ¥å‘Š
   - ä½¿ç”¨ S3 æ™ºèƒ½åˆ†å±‚

2. **Lambda ä¼˜åŒ–**
   - ç›‘æ§å‡½æ•°æ‰§è¡Œæ—¶é—´
   - ä¼˜åŒ–ä»£ç å‡å°‘æ‰§è¡Œæ—¶é—´

3. **Inspector ä¼˜åŒ–**
   - æ ¹æ®éœ€æ±‚è°ƒæ•´æ‰«æé¢‘ç‡
   - åªæ‰«æå¿…è¦çš„èµ„æº

## ğŸ¯ æœ€ä½³å®è·µ

### å®‰å…¨æœ€ä½³å®è·µ

1. **æœ€å°æƒé™åŸåˆ™**
   - åªç»™å¿…è¦çš„æƒé™
   - å®šæœŸå®¡æŸ¥ IAM è§’è‰²

2. **åŠ å¯†ä¿æŠ¤**
   - ç¡®ä¿æ•°æ®åŠ å¯†å­˜å‚¨
   - ä½¿ç”¨ HTTPS ä¼ è¾“

3. **å®¡è®¡æ—¥å¿—**
   - å¯ç”¨ CloudTrail æ—¥å¿—
   - å®šæœŸå®¡æŸ¥è®¿é—®è®°å½•

### æ“ä½œæœ€ä½³å®è·µ

1. **æµ‹è¯•ç¯å¢ƒå…ˆè¡Œ**
   - å…ˆåœ¨å¼€å‘ç¯å¢ƒæµ‹è¯•
   - éªŒè¯è¡¥ä¸å…¼å®¹æ€§

2. **å˜æ›´ç®¡ç†**
   - è®°å½•æ‰€æœ‰å˜æ›´
   - ä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶

3. **å¤‡ä»½ç­–ç•¥**
   - å®šæœŸå¤‡ä»½é…ç½®
   - æµ‹è¯•æ¢å¤æµç¨‹

## ğŸ“ è·å–å¸®åŠ©

### æŠ€æœ¯æ”¯æŒ

1. **æŸ¥çœ‹æ—¥å¿—**
   - CloudWatch æ—¥å¿—
   - Lambda å‡½æ•°æ—¥å¿—
   - Systems Manager æ—¥å¿—

2. **å¸¸è§é—®é¢˜**
   - æŸ¥çœ‹æ•…éšœæ’é™¤æŒ‡å—
   - æœç´¢ GitHub Issues

3. **è”ç³»æ”¯æŒ**
   - åˆ›å»º GitHub Issue
   - è”ç³» AWS æ”¯æŒ

### å­¦ä¹ èµ„æº

1. **AWS æ–‡æ¡£**
   - Systems Manager æ–‡æ¡£
   - Inspector æ–‡æ¡£
   - CloudFormation æ–‡æ¡£

2. **è§†é¢‘æ•™ç¨‹**
   - AWS å®˜æ–¹è§†é¢‘
   - ç¤¾åŒºæ•™ç¨‹

3. **å®è·µç»ƒä¹ **
   - AWS å…è´¹å¥—é¤
   - æ²™ç›’ç¯å¢ƒ 